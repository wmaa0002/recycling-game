<!DOCTYPE html> 
<head> 
	<meta charset="UTF-8" />
	<title>Recycling game</title>
  <script src="js/phaser.min.js"></script>
</head>
<body>

<script>

var game = new Phaser.Game(640, 480, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update });

function preload() {
  game.load.image('background', 'assets/background1.png');
  game.load.image('candy-red', 'assets/candy-red.png');
  game.load.image('red-bin', 'assets/redbin.jpg');
  game.load.image('green-bin', 'assets/bin-icon.png');

  game.load.image('apple', 'assets/apple-icon.png');
  game.load.image('water-bottle', 'assets/bottle-icon.png');
  game.load.image('coke', 'assets/coke-can.png');
  game.load.image('milk-box', 'assets/milk-can.png');
  game.load.image('right-sign', 'assets/right.png');
  game.load.image('gameover', 'assets/game-over.png')
  // game.load.spritesheet('dude', 'assets/dude.png', 32, 48);
}


// var recyclingBin;
// var generalBin;
// var apple;
// var waterBottle;
// var coke;
// var milkBox;
// var candyRed;
// var rightSign;
// var text;

function create() {
  game.physics.startSystem(Phaser.Physics.ARCADE)
  this.palying = true;
  game.add.sprite(0, 0, 'background');  

  recyclingBin = game.add.sprite(300, 400, 'green-bin');
  recyclingBin.anchor.set(0.5);
  // 使用tween.from，它会从上面运用到中间
  // game.add.tween(recyclingBin).from( { y: -200 }, 2000, Phaser.Easing.Bounce.Out, true);
  game.physics.enable(recyclingBin, Phaser.Physics.ARCADE);

  // generalBin = game.add.sprite(500, 400, 'green-bin');
  // generalBin.anchor.set(0.5);
  // game.add.tween(generalBin).from( { y: -200 }, 2000, Phaser.Easing.Bounce.Out, true);
  // game.physics.enable(generalBin, Phaser.Physics.ARCADE);


  candyRed = game.add.sprite(300, 200, 'candy-red');
  // 启动输入系统600
  candyRed.inputEnabled = true;
  // 允许拖拽，第一个参数true代表拖拽的时候鼠标位于精灵中心
  candyRed.input.enableDrag(true);
  game.physics.enable(candyRed, Phaser.Physics.ARCADE);

  apple = game.add.sprite(100, 200, 'apple');
  // 启动输入系统600
  apple.inputEnabled = true;
  // 允许拖拽，第一个参数true代表拖拽的时候鼠标位于精灵中心
  apple.input.enableDrag(true);
  game.physics.enable(apple, Phaser.Physics.ARCADE);

  waterBottle = game.add.sprite(150, 200, 'water-bottle');
  // 启动输入系统600
  waterBottle.inputEnabled = true;
  // 允许拖拽，第一个参数true代表拖拽的时候鼠标位于精灵中心
  waterBottle.input.enableDrag(true);
  game.physics.enable(waterBottle, Phaser.Physics.ARCADE);

  coke = game.add.sprite(300, 100, 'coke');
  // 启动输入系统600
  coke.inputEnabled = true;
  // 允许拖拽，第一个参数true代表拖拽的时候鼠标位于精灵中心
  coke.input.enableDrag(true);
  game.physics.enable(coke, Phaser.Physics.ARCADE);

  milkBox = game.add.sprite(400, 200, 'milk-box');
  // 启动输入系统600
  milkBox.inputEnabled = true;
  // 允许拖拽，第一个参数true代表拖拽的时候鼠标位于精灵中心
  milkBox.input.enableDrag(true);
  game.physics.enable(milkBox, Phaser.Physics.ARCADE);

  text = game.add.text(16, 16, 'drag the item', { fill: '#ffffff' });
}

function update() {
  if (checkOverlap(recyclingBin, waterBottle)) {
    waterBottle.kill();
    showRightSign();
    } 
  if (checkOverlap(recyclingBin, candyRed )) {
    candyRed.kill();
    gameOverState();
  }
   
}

function showRightSign() {
  rightSign = game.add.sprite(250, 250, 'right-sign')
  // rightSign.anchor.setTo(0.5,0.5);
  game.time.events.add(2000, fadePicture, this);
}

function fadePicture() {

    game.add.tween(rightSign).to( { alpha: 0 }, 2000, Phaser.Easing.Linear.None, true);

}

function checkOverlap(spriteA, spriteB) {
    var boundsA = spriteA.getBounds();
    var boundsB = spriteB.getBounds();
    return Phaser.Rectangle.intersects(boundsA, boundsB);
}

function gameOverState() {
    this.playing = false;
    var gameOverSprite = game.add.sprite(0, 0, 'gameover');
    gameOverSprite.anchor.setTo(0.5, 0.5);
    gameOverSprite.scale.setTo(0, 0);
    gameOverSprite.reset(game.width/2, game.height/2);
    game.add.tween(gameOverSprite.scale).to({x: 1.0, y: 1.0}, 300, Phaser.Easing.Sinusoidal.InOut, true);
    // game.input.onUp.add(this.restartGame, this);
  }


// function restartGame() {
//     game.state.start('main');
//   }



 </script>
</body>

</html>